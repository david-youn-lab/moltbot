# 시스템 아키텍처

## 전체 구조

```
┌──────────────────────────────────────────────────────────────────┐
│                        사용자 인터페이스                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │
│  │  음성    │  │   웹     │  │  모바일  │  │   CLI    │         │
│  │  입력    │  │ 대시보드 │  │   앱     │  │         │         │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘         │
└───────┼─────────────┼─────────────┼─────────────┼────────────────┘
        │             │             │             │
        └─────────────┴──────┬──────┴─────────────┘
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                        컨트롤타워                                │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    REST API (FastAPI)                     │  │
│  └──────────────────────────────────────────────────────────┘  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ 명령어   │  │  상태    │  │  이벤트  │  │  인증    │       │
│  │ 라우터   │  │  관리    │  │  처리    │  │  관리    │       │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └──────────┘       │
└───────┼─────────────┼─────────────┼──────────────────────────────┘
        │             │             │
        └─────────────┴──────┬──────┘
                             │
┌────────────────────────────▼────────────────────────────────────┐
│                     MQTT 메시지 브로커                           │
└────────────────────────────┬────────────────────────────────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
┌───────▼──────┐    ┌───────▼──────┐    ┌───────▼──────┐
│ 음성제어기능  │    │ 주변기기설정  │    │   AI비서     │
│              │    │              │    │              │
│ - Whisper    │    │ - Matter     │    │ - LLM        │
│ - VAD        │    │ - MQTT       │    │ - TTS        │
│ - 파싱       │    │ - BLE        │    │ - 대화관리   │
└──────────────┘    └───────┬──────┘    └──────────────┘
                            │
                    ┌───────▼───────┐
                    │   IoT 기기들   │
                    │               │
                    │ 조명, 에어컨,  │
                    │ TV, 센서 등   │
                    └───────────────┘
```

## 데이터 흐름

### 음성 명령 처리

```
1. 음성 입력
   ↓
2. VAD (음성 구간 감지)
   ↓
3. Whisper (음성 → 텍스트)
   ↓
4. CommandParser (텍스트 → 구조화 명령)
   ↓
5. 컨트롤타워 (명령 라우팅)
   ↓
6. MQTT 발행 (기기 제어)
   ↓
7. IoT 기기 동작
   ↓
8. 상태 업데이트
   ↓
9. 사용자 피드백
```

## 모듈 의존성

```
공통라이브러리 (기반)
    ↑
    ├── 컨트롤타워
    ├── 음성제어기능
    ├── 주변기기설정
    └── AI비서
```

## 통신 프로토콜

| 구간 | 프로토콜 | 용도 |
|------|----------|------|
| 클라이언트 ↔ 서버 | HTTP/REST | API 호출 |
| 클라이언트 ↔ 서버 | WebSocket | 실시간 업데이트 |
| 서버 ↔ 기기 | MQTT | 기기 제어/상태 |
| 기기 ↔ 기기 | Matter/Thread | 직접 통신 |

## 확장성

### 수평 확장
- 컨트롤타워 다중 인스턴스
- MQTT 클러스터링
- 로드 밸런싱

### 기능 확장
- 새 기기 타입 추가
- 새 프로토콜 추가
- 새 AI 모델 적용
